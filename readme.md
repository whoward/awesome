Big thanks to lifo for his example cramp application, much of which is used here:

https://github.com/lifo/cramp-pub-sub-chat-demo